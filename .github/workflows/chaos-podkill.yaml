name: Chaos Mesh kill pod
run-name: Chaos Mesh kill Pod run by ${{ github.actor }}
on: [push]
jobs:
  chaos-pod-kill:
    runs-on: ubuntu-latest
    steps:
      - name: 📦 Checkout repository
        uses: actions/checkout@v4

      - name: 🛠️ Install Helm
        uses: azure/setup-helm@v4.3.0

      - name: 🔐 Configure Kubeconfig
        uses: azure/k8s-set-context@v4
        with:
          method: kubeconfig
          kubeconfig: ${{ secrets.KUBECONFIG }}

      - run: |
          echo "📋 rgatt pods before pod-kill :"
          kubectl get pods -l app=rgatt -o wide

      - name: ☠️ Kill one pod with Chaos Mesh
        run: |
          helm install -f chaos-rgatt-ci chaos/helm \
          chaos/value-rgatt.yaml \
          --set simulation.podKill.enabled=true

      - run: sleep 10          

      - run: |
          echo "📋 rgatt pods after pod-kill :"
          kubectl get pods -l app=rgatt -o wide
